<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title data-react-helmet="true">Building a Blog with Metalsmith • Blake Embrey</title><meta data-react-helmet="true" name="description" content="A personally curated collection of words hosted in cyberspace for an indeterminate duration."/><style data-react-free-style="true">::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}audio:not([controls]){display:none;height:0}b,strong{font-weight:inherit;font-weight:bolder}button,html [type="button"], [type="reset"],[type="submit"]{-webkit-appearance:button}button,input{overflow:visible}button,input,optgroup,select,textarea{margin:0}button,select{text-transform:none}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}audio,video,canvas{display:inline-block}dfn{font-style:italic}article,aside,footer,header,nav,section,details,menu,figcaption,figure,main{display:block}figure{margin:1em 40px}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.15}img{border-style:none}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}mark{background-color:#ff0;color:#000}code,kbd,samp,pre{font-family:monospace, monospace;font-size:1em}progress{display:inline-block;vertical-align:baseline}small{font-size:80%}sub{bottom:-0.25em}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}summary{display:list-item}sup{top:-0.5em}svg:not(:root){overflow:hidden}[hidden],template{display:none}textarea{overflow:auto}*{box-sizing:border-box}.hljs-addition{background:#dfd}.hljs-attribute,.hljs-variable,.hljs-body{color:#008080}.hljs-change{background:#0086b3}.hljs-class .hljs-title,.hljs-type,.hljs-literal,.hljs-command{color:#458;font-weight:500}.hljs-deletion{background:#fdd}.hljs-header,.hljs-comment,.hljs-javadoc{color:#969896}.hljs-keyword,.hljs-winutils,.hljs-subst,.hljs-request,.hljs-status{color:#a71d5d}.hljs-built_in,.hljs-number,.hljs-hexcolor,.hljs-constant{color:#0086b3}.hljs-preprocessor,.hljs-pragma,.hljs-pi,.hljs-doctype,.hljs-shebang,.hljs-cdata{color:#999;font-weight:500}.hljs-regexp{color:#009926}.hljs-string,.hljs-tag .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.hljs-formula{color:#df5000}.hljs-symbol,.hljs-symbol .hljs-string,.hljs-special,.hljs-prompt{color:#990073}.hljs-tag,.hljs-tag .hljs-title,.hljs-rules .hljs-property{color:#000080}.hljs-title,.hljs-id,.hljs-preprocessor{color:#795da3}a{border-bottom:2px solid #dcdcdc;color:#111;text-decoration:none}a:hover{border-bottom-color:#f20}body{color:#111;font-family:sans-serif;font-size:17px;font-weight:300;line-height:1.7;margin:0}pre .diff-addition{background-color:#dfd}.hljs-chunk,pre .diff-chunk{color:#aaa}pre .diff-deletion{background-color:#fdd}.f1evzss3{border-top:4px solid #f20}.fsclf6o{margin:0 auto;max-width:640px;padding:20px}.f5tm013{margin:0;padding:30px 0}.f5tm013 > li{display:inline-block;list-style:none;margin-right:20px}.f5qoj4b{border-bottom-color:transparent;color:#333}.f13o7dmr h1, h2, h3, h4, h5, h6{font-weight:500}.f13o7dmr h1{font-size:1.7em}.f13o7dmr h2{font-size:1.3em}.f13o7dmr h3{font-size:1.1em}.f13o7dmr hr{border-bottom:1px dashed #fff;border-top:1px dashed #aaa;display:block;margin:1.5em 0}.f13o7dmr blockquote{border-left:4px solid #f20;margin:1em 0;padding-left:1em}.f13o7dmr img,audio,embed,video,object{height:auto;max-width:100%}.f13o7dmr code, pre{background-color:#f3f3f3;border:1px solid #ccc;color:#111;font-family:monospace;font-size:0.9em}.f13o7dmr pre{line-height:1.3;overflow-x:auto;padding:0.6em 0.8em}.f13o7dmr code{border-color:#ccc;display:inline;padding:0 0.3em;white-space:pre-line;word-wrap:break-word}.f13o7dmr pre > code{background-color:transparent;border:none;font-size:100%;padding:0;white-space:pre;word-wrap:normal}.f13o7dmr a:hover > code{border-color:#f20}.f1ymzfbz{color:#777;font-size:0.85em;margin:1.5em 0;padding:0}.f1ymzfbz > li > a{color:#777}.f1ymzfbz > li{display:inline-block;list-style:none;padding-right:20px}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="-1854552074"><!-- react-empty: 2 --><div class="f1evzss3" data-reactid="3"></div><div class="fsclf6o" data-reactid="4"><ul class="f5tm013" data-reactid="5"><li data-reactid="6"><a class="f5qoj4b" href="/" data-reactid="7">Blog</a></li><li data-reactid="8"><a class="f5qoj4b" href="http://blakeembrey.me" data-reactid="9">About</a></li><li data-reactid="10"><a class="f5qoj4b" href="/rss.xml" data-reactid="11">RSS</a></li></ul><div class="f13o7dmr" data-reactid="12"><div data-reactid="13"><!-- react-empty: 14 --><h1 data-reactid="15">Building a Blog with Metalsmith</h1><ul class="f1ymzfbz" data-reactid="16"><li data-reactid="17"><!-- react-text: 18 -->Written<!-- /react-text --><!-- react-text: 19 --> <!-- /react-text --><time datetime="2014-10-04T20:15:00.000Z" data-reactid="20">October 2014</time></li></ul><div data-reactid="21"><p><a href="http://www.metalsmith.io/">Metalsmith</a> is a new addition to static site generator space, only released at the beginning of this year. It’s written in JavaScript and provides an extremely simple plugin system for composing files using middleware. The fact that everything is a plugin makes it incredibly easy to understand what is happening under the hood and extend it when you need to add new functionality.</p>
<h2>Getting Started</h2>
<p>For this tutorial, I converted the blog you’re currently reading to Metalsmith. To start, we’ll create a new project directory, then create a <code>src</code> directory inside of that. The first thing we need to save the snippet below into a <code>package.json</code>, which holds all our blog dependencies.</p>
<pre><code class="language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"example-blog"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Example blog."</span>,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"Blake Embrey"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>
}
</code></pre>
<p>Now that you have a valid <code>package.json</code>, you will need to install <code>metalsmith</code> locally to get started. Execute <code>npm install metalsmith --save</code> and you’ll notice it’s been automatically added to the <code>package.json</code>. With that as the initial dependency, you need to create a <code>build.js</code> file with the content below.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> metalsmith = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith'</span>);

metalsmith(__dirname)
  .source(<span class="hljs-string">'src'</span>)
  .destination(<span class="hljs-string">'build'</span>)
  .build(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">throw</span> err;
    }
  });
</code></pre>
<h2>Adding articles</h2>
<p>Now you have a working Metalsmith instance - it just doesn’t do anything yet. There aren’t any files in <code>src</code> and no plugins are being used to process data yet. First things first, let’s create an <code>articles</code> (or <code>posts</code>, etc.) directory under <code>src</code>. This structure will a part of our url (E.g. <code>/articles/...</code>). Inside the directory you created, you need to create your first markdown file. The snippet below is a very simple article with metadata.</p>
<pre><code>---
title: Example title.
date: 2014-09-29 23:00
author: Blake Embrey
template: article.jade
---

Example content.
</code></pre>
<p>Nothing exciting so far. If you build the blog by executing <code>node build.js</code>, you’ll see a new <code>build</code> directory with the contents copied from the <code>src</code> directory. However, if you look at your markdown article you’ll notice the metadata is missing. That is because the parts between the three dashes at the beginning is YAML font-matter (a type of associated metadata). We can access metadata from within any plugin or template, and it can be added to the beginning of any file and automatically be parsed.</p>
<h2>Processing Markdown</h2>
<p>The next step would be to add markdown processing into our build script. This will allow us to turn the all our markdown into HTML documents. To do this, we’ll install the <a href="https://github.com/segmentio/metalsmith-markdown">metalsmith-markdown</a> (using <code>npm install metalsmith-markdown --save</code>). If we also want syntax highlighting of code snippets, we can use <code>highlight.js</code> (or <code>highlighter</code> which offers a simple abstraction for markdown - <code>npm install highlighter --save</code>).</p>
<pre><code class="language-javascript.diff"><span class="diff-null"><span class="hljs-keyword">var</span> metalsmith  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> markdown    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-markdown'</span>);
<span class="hljs-keyword">var</span> highlighter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlighter'</span>);</span>
<span class="diff-null">
metalsmith(__dirname)
  .source(<span class="hljs-string">'src'</span>)</span>
<span class="diff-addition">  .use(markdown({
    <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">highlight</span>: highlighter()
  }))</span>
<span class="diff-null">  .destination(<span class="hljs-string">'build'</span>)
</span></code></pre>
<p>Running your build script (<code>node build.js</code>) will now result in your markdown file becoming HTML. If you add a code block fenced by three backticks, you’ll also get to see syntax highlighting automatically applied (in HTML, still need to add the CSS - consider starting with a theme from the <a href="https://highlightjs.org/static/demo/">highlight.js demo</a>).</p>
<h2>Templates</h2>
<p>Now it’s time to start making things look pretty by adding templates. Let’s start out with the article template, since you already have an article to work with. Start by installing <a href="https://github.com/segmentio/metalsmith-templates">metalsmith-templates</a> (<code>npm install metalsmith-templates --save</code>) and creating a <code>templates</code> directory. Create your first template file inside the templates directory. Since I’m using <a href="https://github.com/visionmedia/jade">jade</a> I’ve created an <code>article.jade</code> template. Here’s a simple example in Jade:</p>
<pre><code class="language-jade">html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='viewport', content='width=device-width')
    title= title
  body
    h1= title
    div.timestamp= date
    article!= contents
</code></pre>
<p>With the template created, you need to include the plugin. And since I’m using jade, I’ll need to install <code>jade</code> using <code>npm install jade --save</code> (for Handlebars use <code>npm install handlebars --save</code> and change the engine below). Let’s update our <code>build.js</code> with the code below.</p>
<pre><code class="language-javascript.diff"><span class="diff-null"><span class="hljs-keyword">var</span> metalsmith = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith'</span>);
<span class="hljs-keyword">var</span> markdown   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-markdown'</span>);
<span class="hljs-keyword">var</span> highlight  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> templates  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-templates'</span>);</span>
<span class="diff-null">
metalsmith(__dirname)</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-addition">  .use(templates({
    <span class="hljs-attr">engine</span>: <span class="hljs-string">'jade'</span>,
    <span class="hljs-attr">directory</span>: <span class="hljs-string">'templates'</span>
  }))</span>
<span class="diff-null">  .destination(<span class="hljs-string">'build'</span>)
</span></code></pre>
<p>Running <code>node build.js</code> again will give you a complete HTML file in place of our markdown file. However, if you’re using a different template file you will need to update the markdown metadata. In the template file you have access to the variables such as <code>contents</code>, <code>date</code> and <code>title</code> without having to define them. This is because the metadata is coming from our inline definition and <code>contents</code> is our files content. All plugins can interact, manipulate and add to this data.</p>
<h2>Pretty Permalinks</h2>
<p>You can add permalinks to your blog by using <a href="https://github.com/segmentio/metalsmith-permalinks">metalsmith-permalinks</a> (<code>npm install metalsmith-permalinks --save</code>). Although you have the option for setting a pattern to rewrite URLs, I opted to use it without any options set. This is so it’ll just fix up all my paths to look cleaner anyway, and add the fancy <code>path</code> property to the files metadata.</p>
<pre><code class="language-javascript.diff"><span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"><span class="hljs-keyword">var</span> highlight  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);
<span class="hljs-keyword">var</span> templates  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-templates'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> permalinks = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-permalinks'</span>);</span>
<span class="diff-null">
metalsmith(__dirname)</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-addition">  .use(permalinks())</span>
<span class="diff-null">  .use(templates({
    <span class="hljs-attr">engine</span>: <span class="hljs-string">'jade'</span>,
    <span class="hljs-attr">directory</span>: <span class="hljs-string">'templates'</span>
  }))
  .destination(<span class="hljs-string">'build'</span>)
</span></code></pre>
<h2>Collections</h2>
<p>Perfect, so far we’ve got nice fancy URLs and blog posts rendering. Next we’ll want to group all the articles together into a collection for rendering on the homepage. This also links the posts between each other so we can do things like “next” and “previous” links. As you’ve probably realised, you can install a plugin for this purpose - <a href="https://github.com/segmentio/metalsmith-collections">metalsmith-collections</a> using <code>npm install metalsmith-collections --save</code>. Once installed, add it to the <code>build.js</code>.</p>
<pre><code class="language-javascript.diff"><span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"><span class="hljs-keyword">var</span> permalinks  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-permalinks'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> collections = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-collections'</span>);</span>
<span class="diff-null">
metalsmith(__dirname)
  .source(<span class="hljs-string">'src'</span>)</span>
<span class="diff-addition">  .use(collections({
    <span class="hljs-attr">articles</span>: {
      <span class="hljs-attr">pattern</span>: <span class="hljs-string">'articles/**/*.md'</span>,
      <span class="hljs-attr">sortBy</span>: <span class="hljs-string">'date'</span>,
      <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>
    }
  }))</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"></span></code></pre>
<p>The snippet above will match all markdown files in the <code>articles</code> directory, then sort them in chronological order with the most recent one at the beginning - just like a blog. The collection itself is stored as global Metalsmith metadata under <code>collections.articles</code>. Just make sure you add the collections plugin before our templates and markdown plugins since they always run in order.</p>
<h2>Homepage</h2>
<p>Now that we have a collection of all our posts, let’s create a homepage. Using your template engine of choice, you can add a new template file to the <code>templates</code> directory. For example, I’m creating <code>index.jade</code> like below.</p>
<pre><code class="language-jade">html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='viewport', content='width=device-width')
    title= 'Home'
  body
    each article in collections.articles
      article.content-article
        header
          span.timestamp= article.date
          h2
            a(href='/' + article.path)= article.title
</code></pre>
<p>Now we’re talking! Let’s render this template by creating an <code>index.html</code> file in the root of our <code>src</code> directory. This will simply act as metadata for rendering our template, as below.</p>
<pre><code>---
template: index.jade
---
</code></pre>
<p>With that complete, you can run the build again (<code>node build</code>) and stare in awe at your beautiful homepage. At this point you might want to start serving the <code>build</code> folder locally too, so I run <code>npm install -g serve</code> and then used <code>serve build</code> to view the directory.</p>
<h2>Adding Global Metadata</h2>
<p>You may have noticed that it’d be handy to add some generic metadata or modules to reuse in templates. I hear you, so you can install <a href="https://github.com/aymericbeaumet/metalsmith-define">metalsmith-define</a> (<code>npm install metalsmith-define</code>) for this. With that installed, you can now define global metadata anywhere in the metalsmith middleware stack.</p>
<pre><code class="language-javascript.diff"><span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"><span class="hljs-keyword">var</span> collections = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-collections'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> define      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-define'</span>);</span>
<span class="diff-null">
metalsmith(__dirname)
  .source(<span class="hljs-string">'src'</span>)</span>
<span class="diff-addition">  .use(define({
    <span class="hljs-attr">blog</span>: {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'http://blakeembrey.com'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'Blake Embrey'</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">'Hello world.'</span>
    },
    <span class="hljs-attr">owner</span>: {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'http://blakeembrey.me'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Blake Embrey'</span>
    },
    <span class="hljs-attr">moment</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>)
  }))</span>
<span class="diff-null">  .use(collections({
    <span class="hljs-attr">articles</span>: {
      <span class="hljs-attr">pattern</span>: <span class="hljs-string">'articles/**/*.md'</span>,
      <span class="hljs-attr">sortBy</span>: <span class="hljs-string">'date'</span>,
      <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>
    }
  }))</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"></span></code></pre>
<p>With the above, I have defined some information about the blog and the owner. I also added <a href="http://momentjs.com/">moment</a> (<code>npm install moment --save</code>) because it’ll be handy for formatting our dates. I might quickly go back to our article and homepages templates now and wrap our date in <code>moment(date).format('MMMM D, YYYY')</code> for prettier dates. In Handlebars, you can create a <code>formatDate</code> helper and use moment that way.</p>
<h2>Pagination</h2>
<p>Wow, we’re nearly done already! Let’s add the one thing every good blog deserves, pagination. To get started, install <a href="https://github.com/blakeembrey/metalsmith-pagination">metalsmith-pagination</a> (<code>npm install metalsmith-pagination</code>), it works with any array structure and integrates with templates. We can now delete <code>index.md</code> from the <code>src</code> directory as the plugin will generate it for us (using <code>first: 'index.html</code>).</p>
<pre><code class="language-javascript.diff"><span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"><span class="hljs-keyword">var</span> define      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-define'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> pagination  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-pagination'</span>);</span>
<span class="diff-null"></span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-null">  .use(collections({
    <span class="hljs-attr">articles</span>: {
      <span class="hljs-attr">pattern</span>: <span class="hljs-string">'articles/**/*.md'</span>,
      <span class="hljs-attr">sortBy</span>: <span class="hljs-string">'date'</span>,
      <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>
    }
  }))</span>
<span class="diff-addition">  .use(pagination({
    <span class="hljs-string">'collections.articles'</span>: {
      <span class="hljs-attr">perPage</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">first</span>: <span class="hljs-string">'index.html'</span>,
      <span class="hljs-attr">path</span>: <span class="hljs-string">'page/:num/index.html'</span>,
      <span class="hljs-attr">template</span>: <span class="hljs-string">'index.jade'</span>
    }
  }))</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"></span></code></pre>
<p>We can set a limit of files per page, the path to all pages, an alternative first page location, and the template for rendering the files. With this defined, you’ll need to make some tweaks and improvements to the <code>index.jade</code> template.</p>
<pre><code class="language-jade.diff"><span class="diff-null">html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='viewport', content='width=device-width')
    title= 'Home'
  body</span>
<span class="diff-deletion">    each article in collections.articles</span>
<span class="diff-addition">    each article in pagination.files</span>
<span class="diff-null">      article.content-article
        header
          span.timestamp= moment(article.date).format('MMMM D, YYYY')
          h2
            a(href='/' + article.path)= article.title</span>
<span class="diff-addition">  nav
    if pagination.previous
      a.btn(href='/' + pagination.previous.path)
        | Newer
    if pagination.next
      a.btn(href='/' + pagination.next.path)
        | Older</span>
<span class="diff-null"></span></code></pre>
<p>Notice that the loop has changed to iterate over <code>pagination.files</code> instead. Also “next” and “previous” buttons have been added to the homepage. For the plugin to work properly, it needs to be included after the collections plugin, but before the permalinks and templates plugins. This works because we need access to the collections metadata in the plugin, but need the generated files to have a path and content created using templates.</p>
<h2>Article Snippets</h2>
<p>Another thing that all good blogs seem to have are content snippets. For this, you’ll install <a href="https://github.com/blakeembrey/metalsmith-snippet">metalsmith-snippet</a> which allows you to access a short snippet of the HTML files in templates. Let’s include the plugin in the <code>build.js</code> file.</p>
<pre><code class="language-javascript.diff"><span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"><span class="hljs-keyword">var</span> paginate    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-collections-paginate'</span>);</span>
<span class="diff-addition"><span class="hljs-keyword">var</span> snippet     = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-snippet'</span>);</span>
<span class="diff-null"></span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-addition">  .use(snippet())</span>
<span class="diff-null">  .use(permalinks())
  .use(templates({
    <span class="hljs-attr">engine</span>: <span class="hljs-string">'jade'</span>,
    <span class="hljs-attr">directory</span>: <span class="hljs-string">'templates'</span>
  }))</span>
<span class="diff-chunk">@@ ... @@</span>
<span class="diff-null"></span></code></pre>
<p>This will automatically generate a snippet for all the articles based on a number of characters. Make sure it comes after the markdown parsing is done though. With this enabled, we can add <code>article.snippet</code> to the homepage template and print out article summaries.</p>
<h2>Enable XML Feed</h2>
<p>Next up, we will enable an XML feed for the blog. This will allow people to subscribe to the blog for new articles in feed readers. To do this, you’ll need to create a template for our feed. Here’s my <code>feed.jade</code> template:</p>
<pre><code class="language-jade">doctype xml
rss(version='2.0',
    xmlns:content='http://purl.org/rss/1.0/modules/content/',
    xmlns:wfw='http://wellformedweb.org/CommentAPI/',
    xmlns:dc='http://purl.org/dc/elements/1.1/'
    xmlns:atom='http://www.w3.org/2005/Atom')
  channel
    title= blog.title
    atom:link(href=blog.url + '/feed.xml', rel='self', type='application/rss+xml')
    link= blog.url
    description= blog.description
    pubDate= moment(date).format('ddd, DD MMM YYYY HH:mm:ss ZZ')
    language en
    for article in collections.articles
      - var permalink = blog.url + '/' + article.path
      item
        title= article.title
        link= permalink
        pubDate= moment(article.date).format('ddd, DD MMM YYYY HH:mm:ss ZZ')
        guid(isPermaLink='true')= permalink
        author= article.author
        description= article.snippet
</code></pre>
<p>The snippet above is creating a new XML document. We add a bunch of metadata properties to the XML feed for describing various things, then iterate over all the articles and output each article as an XML <code>item</code>. The one new thing you might notice is the global <code>date</code> variable, which is added by <a href="https://github.com/segmentio/metalsmith-build-date">metalsmith-build-date</a> (<code>npm install metalsmith-build-date</code> and <code>.use(date())</code>). For this template to render, we will create a <code>feed.xml</code> in the <code>src</code> directory with the content below.</p>
<pre><code>---
template: feed.jade
---
</code></pre>
<h2>Adding Comments</h2>
<p>One important aspect of a blog is having a place for readers to leave their comments and thoughts, with the goal of continuing the discussion beyond the original article. For a static site, our comment systems are little more limited to JavaScript implementations that provide their own backend for storage. Personally, I tend to gravitate toward <a href="http://disqus.com/">disqus</a>. Let’s add their snippet to the bottom of <code>article.jade</code>.</p>
<pre><code class="language-jade">div#disqus_thread

script.
  //- Disqus code snippet
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//blakeembrey.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</code></pre>
<h2>Deploying to Github Pages</h2>
<p>Now that we’ve got our static site running, we need to find a way to distribute it to the masses. We can host it anywhere statically without any hassle, but I opted to use <a href="https://pages.github.com/">Github Pages</a>. For this to work I added a <code>CNAME</code> file to the <code>src</code> directory - this is needed for Github to allow a custom domain.</p>
<pre><code>blakeembrey.com
</code></pre>
<p>Next, I created a simple deploy script and added it to my <code>package.json</code>.</p>
<pre><code class="language-json.diff"><span class="diff-null">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"example-blog"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Example blog."</span>,</span>
<span class="diff-addition">  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"node build.js"</span>,
    <span class="hljs-attr">"deploy"</span>: <span class="hljs-string">"npm run build &amp;&amp; cd build &amp;&amp; git init . &amp;&amp; git add . &amp;&amp; git commit -m \"Deploy\"; git push \"git@github.com:blakeembrey/blakeembrey.com.git\" master:gh-pages --force &amp;&amp; rm -rf .git"</span>
  },</span>
<span class="diff-null">  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"Blake Embrey"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>
}
</span></code></pre>
<p>For the build script above to work for you, you’ll need to change the repository (<code>blakeembrey/blakeembrey.com</code>) to your Github repository.</p>
<h2>Extra Goodies</h2>
<p>I also implemented a couple of bonus things in this blog during development - <a href="https://github.com/esundahl/metalsmith-autoprefixer">metalsmith-autoprefixer</a> for adding browser prefixes to my CSS and <a href="https://github.com/aymericbeaumet/metalsmith-redirect">metalsmith-redirect</a> for maintaining backwards compatibility with my old URLs. Check out the <a href="http://www.metalsmith.io/">Metalsmith homepage</a> to discover more great plugins.</p>
<h2>Live!</h2>
<p>And we’re done, let’s get this blog live. All we need to do now is execute <code>npm run deploy</code>, which will run the build and deploy scripts and push to Github. All code and content for this blog and article is <a href="https://github.com/blakeembrey/blakeembrey.com">open source</a>, so feel free to browse for more ideas.</p>
</div><hr data-reactid="22"/><p data-reactid="23"><strong data-reactid="24">Questions?</strong><!-- react-text: 25 --> <!-- /react-text --><!-- react-text: 26 -->Ask me on<!-- /react-text --><!-- react-text: 27 --> <!-- /react-text --><a href="https://twitter.com/blakeembrey" data-reactid="28">Twitter</a><!-- react-text: 29 --> <!-- /react-text --><!-- react-text: 30 -->or in<!-- /react-text --><!-- react-text: 31 --> <!-- /react-text --><a href="https://github.com/blakeembrey/knowledge" data-reactid="32">my repo</a><!-- react-text: 33 -->.<!-- /react-text --></p></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', "UA-22855713-2", 'auto');
          ga('send', 'pageview');</script><script src="/bundle.js?t=1491836883589"></script></body></html>