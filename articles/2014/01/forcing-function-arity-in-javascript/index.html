<!DOCTYPE html>
 <html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title data-react-helmet="true">Forcing Function Arity in JavaScript • Blake Embrey</title><meta data-react-helmet="true" name="og:type" content="article"/><meta data-react-helmet="true" name="og:title" content="Forcing Function Arity in JavaScript"/><meta data-react-helmet="true" name="og:site_name" content="Blake Embrey"/><meta data-react-helmet="true" name="og:url" content="http://blakeembrey.com/articles/2014/01/forcing-function-arity-in-javascript/"/><meta data-react-helmet="true" name="description" content="Function arity in something in JavaScript that is usually overlooked. For the most part, that’s perfectly understandable, it’s just a number. Unfortunately, this number can be integral to many other functions working correctly.…"/><meta data-react-helmet="true" name="og:description" content="Function arity in something in JavaScript that is usually overlooked. For the most part, that’s perfectly understandable, it’s just a number. Unfortunately, this number can be integral to many other functions working correctly.…"/><meta data-react-helmet="true" name="article:published_time" content="2014-01-23T07:30:00.000Z"/><meta data-react-helmet="true" name="twitter:site" content="@blakeembrey"/><style data-react-free-style="true">::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}audio:not([controls]){display:none;height:0}b,strong{font-weight:inherit;font-weight:bolder}button,html [type="button"], [type="reset"],[type="submit"]{-webkit-appearance:button}button,input{overflow:visible}button,input,optgroup,select,textarea{margin:0}button,select{text-transform:none}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}audio,video,canvas{display:inline-block}dfn{font-style:italic}article,aside,footer,header,nav,section,details,menu,figcaption,figure,main{display:block}figure{margin:1em 40px}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.15}img{border-style:none}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}mark{background-color:#ff0;color:#000}code,kbd,samp,pre{font-family:monospace, monospace;font-size:1em}progress{display:inline-block;vertical-align:baseline}small{font-size:80%}sub{bottom:-0.25em}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}summary{display:list-item}sup{top:-0.5em}svg:not(:root){overflow:hidden}[hidden],template{display:none}textarea{overflow:auto}*{box-sizing:border-box}.hljs-addition{background:#dfd}.hljs-attribute,.hljs-variable,.hljs-body{color:#008080}.hljs-change{background:#0086b3}.hljs-class .hljs-title,.hljs-type,.hljs-literal,.hljs-command{color:#458;font-weight:500}.hljs-deletion{background:#fdd}.hljs-header,.hljs-comment,.hljs-javadoc{color:#969896}.hljs-keyword,.hljs-winutils,.hljs-subst,.hljs-request,.hljs-status{color:#a71d5d}.hljs-built_in,.hljs-number,.hljs-hexcolor,.hljs-constant{color:#0086b3}.hljs-preprocessor,.hljs-pragma,.hljs-pi,.hljs-doctype,.hljs-shebang,.hljs-cdata{color:#999;font-weight:500}.hljs-regexp{color:#009926}.hljs-string,.hljs-tag .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.hljs-formula{color:#df5000}.hljs-symbol,.hljs-symbol .hljs-string,.hljs-special,.hljs-prompt{color:#990073}.hljs-tag,.hljs-tag .hljs-title,.hljs-rules .hljs-property{color:#000080}.hljs-title,.hljs-id,.hljs-preprocessor{color:#795da3}a{border-bottom:2px solid #dcdcdc;color:#111;text-decoration:none}a:hover{border-bottom-color:#f20}body{color:#111;font-family:sans-serif;font-size:17px;font-weight:300;line-height:1.7;margin:0}pre .diff-addition{background-color:#dfd}.hljs-chunk,pre .diff-chunk{color:#aaa}pre .diff-deletion{background-color:#fdd}.f1evzss3{border-top:4px solid #f20}.fsclf6o{margin:0 auto;max-width:640px;padding:20px}.f5tm013{margin:0;padding:30px 0}.f5tm013 > li{display:inline-block;list-style:none;margin-right:20px}.f5qoj4b{border-bottom-color:transparent;color:#333}.f13o7dmr h1, h2, h3, h4, h5, h6{font-weight:500}.f13o7dmr h1{font-size:1.7em}.f13o7dmr h2{font-size:1.3em}.f13o7dmr h3{font-size:1.1em}.f13o7dmr hr{border-bottom:1px dashed #fff;border-top:1px dashed #aaa;display:block;margin:1.5em 0}.f13o7dmr blockquote{border-left:4px solid #f20;margin:1em 0;padding-left:1em}.f13o7dmr img,audio,embed,video,object{height:auto;max-width:100%}.f13o7dmr code, pre{background-color:#f3f3f3;border:1px solid #ccc;color:#111;font-family:monospace;font-size:0.9em}.f13o7dmr pre{line-height:1.3;overflow-x:auto;padding:0.6em 0.8em}.f13o7dmr code{border-color:#ccc;display:inline;padding:0 0.3em;white-space:pre-line;word-wrap:break-word}.f13o7dmr pre > code{background-color:transparent;border:none;font-size:100%;padding:0;white-space:pre;word-wrap:normal}.f13o7dmr a:hover > code{border-color:#f20}.f1ymzfbz{color:#777;font-size:0.85em;margin:1.5em 0;padding:0}.f1ymzfbz > li > a{color:#777}.f1ymzfbz > li{display:inline-block;list-style:none;padding-right:20px}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="-309332397"><!-- react-empty: 2 --><div class="f1evzss3" data-reactid="3"></div><div class="fsclf6o" data-reactid="4"><ul class="f5tm013" data-reactid="5"><li data-reactid="6"><a class="f5qoj4b" href="/" data-reactid="7">Blog</a></li><li data-reactid="8"><a class="f5qoj4b" href="http://blakeembrey.me" data-reactid="9">About</a></li><li data-reactid="10"><a class="f5qoj4b" href="/rss.xml" data-reactid="11">RSS</a></li></ul><div class="f13o7dmr" data-reactid="12"><div data-reactid="13"><!-- react-empty: 14 --><h1 data-reactid="15">Forcing Function Arity in JavaScript</h1><ul class="f1ymzfbz" data-reactid="16"><li data-reactid="17"><!-- react-text: 18 -->Written<!-- /react-text --><!-- react-text: 19 --> <!-- /react-text --><time datetime="2014-01-23T07:30:00.000Z" data-reactid="20">January 2014</time></li><li data-reactid="21"><a href="https://github.com/blakeembrey/arity" data-reactid="22">View on GitHub</a></li><li data-reactid="23"><a href="http://npmjs.org/package/util-arity" data-reactid="24">Install with NPM</a></li></ul><div data-reactid="25"><p>Function arity in something in JavaScript that is usually overlooked. For the most part, that’s perfectly understandable, it’s just a number. Unfortunately, this number can be integral to many other functions working correctly. But first, what number am I talking about?</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> fn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{};

fn.length; <span class="hljs-comment">//=&gt; 2</span>
</code></pre>
<p>As you can see, the length gives up the exact number of arguments the function is expecting to be passed in. This can be useful for other functions that might want to alter its behaviour based on this digit. For example, I found outlining this issue <a href="http://raganwald.com/2013/03/21/arity-and-partial-function-application.html">with currying</a>. Basically, the <code>curry</code> function implementation relies on using the arity information to know how many times the function needs to be curried.</p>
<p>To force the number of arity in our returned anonymous functions, we need to dynamically generate a function with the specified number of arguments. Why? Because the previous implementations of <a href="http://blakeembrey.com/articles/wrapping-javascript-functions/">wrapping functions</a>, <a href="http://blakeembrey.com/articles/javascript-bind-function/">bind</a>, <a href="http://blakeembrey.com/articles/javascript-variadic-function/">variadic</a> and every other functional utility I have demonstrated don’t proxy the number of arguments through the returned function.</p>
<p>This can be a problem in the case where we want to use this function somewhere that expects a function length to work correctly, like when currying. We could fix this at the source, a half a dozen times and any number of times more. Or we could write a little utility that will enfore a number of arguments for us.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> names   = <span class="hljs-string">'abcdefghijklmnopqrstuvwxyz'</span>;
<span class="hljs-keyword">var</span> __slice = <span class="hljs-built_in">Array</span>.prototype.slice;

<span class="hljs-comment">/**
 * Make a function appear as though it accepts a certain number of arguments.
 *
 * @param  {Number}   length
 * @param  {Function} fn
 * @return {Function}
 */</span>
<span class="hljs-keyword">var</span> arity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">length, fn</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(
    <span class="hljs-string">'(function ('</span> + __slice.call(names, <span class="hljs-number">0</span>, length).join(<span class="hljs-string">','</span>) + <span class="hljs-string">') {\n'</span> +
    <span class="hljs-string">'return fn.apply(this, arguments);\n'</span> +
    <span class="hljs-string">'})'</span>
  );
};
</code></pre>
<p>The above function allows us to pass in an argument length and a function to proxy. It then returns to us an anonymous function with the correct number of arguments defined (<code>.length</code> works!) and allows us to call the function and return the usual result. It doesn’t do anything to the arguments in the interim, it just tells the world how many arguments we are accepting.</p>
<h2>The Other Arity Problem</h2>
<p>So we’ve touched one of the arity problems, which is a expecting to read the correct arity from a function. The reverse arity problem is when a function is called with incorrect or overloaded arguments. Consider <code>parseInt</code>, which accepts two arguments - a string and the radix.</p>
<pre><code class="language-javascript">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>].map(<span class="hljs-built_in">parseInt</span>); <span class="hljs-comment">//=&gt; [1, NaN, NaN, NaN, NaN]</span>
</code></pre>
<p>Now we’re having problems. To fix this we can make a utility function that limits the number of arguments passed through.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> __slice = <span class="hljs-built_in">Array</span>.prototype.slice;

<span class="hljs-comment">/**
 * Force a function to accept a specific number of arguments.
 *
 * @param  {Number}   length
 * @param  {Function} fn
 * @return {Function}
 */</span>
<span class="hljs-keyword">var</span> nary = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">length, fn</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-keyword">this</span>, __slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>, length));
  };
};
</code></pre>
<p>If you’ve been reading, you would have just noticed that we introduced the original bug we’ve been trying to avoid. That is, we’re returning a new anonymous function without proxying the number of arguments through. Let’s quickly correct that with the function we just wrote.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> __slice = <span class="hljs-built_in">Array</span>.prototype.slice;

<span class="hljs-comment">/**
 * Force a function to accept a specific number of arguments.
 *
 * @param  {Number}   length
 * @param  {Function} fn
 * @return {Function}
 */</span>
<span class="hljs-keyword">var</span> nary = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">length, fn</span>) </span>{
  <span class="hljs-comment">// Uses the previous function to proxy the number of arguments.</span>
  <span class="hljs-keyword">return</span> arity(length, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-keyword">this</span>, __slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>, length));
  });
};
</code></pre>
<p>Now we can use this to fix our map error from earlier. We also have the added bonus of a correct argument representation.</p>
<pre><code class="language-javascript">nary(<span class="hljs-number">1</span>, <span class="hljs-built_in">parseInt</span>).length; <span class="hljs-comment">//=&gt; 1</span>

[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>].map(nary(<span class="hljs-number">1</span>, <span class="hljs-built_in">parseInt</span>)); <span class="hljs-comment">//=&gt; [1, 2, 3, 4, 5]</span>
</code></pre>
</div><hr data-reactid="26"/><p data-reactid="27"><strong data-reactid="28">Questions?</strong><!-- react-text: 29 --> <!-- /react-text --><!-- react-text: 30 -->Ask me on<!-- /react-text --><!-- react-text: 31 --> <!-- /react-text --><a href="https://twitter.com/blakeembrey" data-reactid="32">Twitter</a><!-- react-text: 33 --> <!-- /react-text --><!-- react-text: 34 -->or in<!-- /react-text --><!-- react-text: 35 --> <!-- /react-text --><a href="https://github.com/blakeembrey/knowledge" data-reactid="36">my repo</a><!-- react-text: 37 -->.<!-- /react-text --></p></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', "UA-22855713-2", 'auto');
          ga('send', 'pageview');</script></body></html>