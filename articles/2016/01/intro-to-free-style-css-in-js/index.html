<!DOCTYPE html>
 <html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title data-react-helmet="true">Introduction to Free Style (and CSS-in-JS) • Blake Embrey</title><meta data-react-helmet="true" name="description" content="A personally curated collection of words hosted in cyberspace for an indeterminate duration."/><meta data-react-helmet="true" name="og:type" content="article"/><meta data-react-helmet="true" name="og:title" content="Introduction to Free Style (and CSS-in-JS)"/><meta data-react-helmet="true" name="og:site_name" content="Blake Embrey"/><meta data-react-helmet="true" name="og:url" content="http://blakeembrey.com/articles/2016/01/intro-to-free-style-css-in-js/"/><meta data-react-helmet="true" name="article:published_time" content="2016-01-17T22:45:00.000Z"/><meta data-react-helmet="true" name="twitter:site" content="@blakeembrey"/><style data-react-free-style="true">::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}audio:not([controls]){display:none;height:0}b,strong{font-weight:inherit;font-weight:bolder}button,html [type="button"], [type="reset"],[type="submit"]{-webkit-appearance:button}button,input{overflow:visible}button,input,optgroup,select,textarea{margin:0}button,select{text-transform:none}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}audio,video,canvas{display:inline-block}dfn{font-style:italic}article,aside,footer,header,nav,section,details,menu,figcaption,figure,main{display:block}figure{margin:1em 40px}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.15}img{border-style:none}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}mark{background-color:#ff0;color:#000}code,kbd,samp,pre{font-family:monospace, monospace;font-size:1em}progress{display:inline-block;vertical-align:baseline}small{font-size:80%}sub{bottom:-0.25em}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}summary{display:list-item}sup{top:-0.5em}svg:not(:root){overflow:hidden}[hidden],template{display:none}textarea{overflow:auto}*{box-sizing:border-box}.hljs-addition{background:#dfd}.hljs-attribute,.hljs-variable,.hljs-body{color:#008080}.hljs-change{background:#0086b3}.hljs-class .hljs-title,.hljs-type,.hljs-literal,.hljs-command{color:#458;font-weight:500}.hljs-deletion{background:#fdd}.hljs-header,.hljs-comment,.hljs-javadoc{color:#969896}.hljs-keyword,.hljs-winutils,.hljs-subst,.hljs-request,.hljs-status{color:#a71d5d}.hljs-built_in,.hljs-number,.hljs-hexcolor,.hljs-constant{color:#0086b3}.hljs-preprocessor,.hljs-pragma,.hljs-pi,.hljs-doctype,.hljs-shebang,.hljs-cdata{color:#999;font-weight:500}.hljs-regexp{color:#009926}.hljs-string,.hljs-tag .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.hljs-formula{color:#df5000}.hljs-symbol,.hljs-symbol .hljs-string,.hljs-special,.hljs-prompt{color:#990073}.hljs-tag,.hljs-tag .hljs-title,.hljs-rules .hljs-property{color:#000080}.hljs-title,.hljs-id,.hljs-preprocessor{color:#795da3}a{border-bottom:2px solid #dcdcdc;color:#111;text-decoration:none}a:hover{border-bottom-color:#f20}body{color:#111;font-family:sans-serif;font-size:17px;font-weight:300;line-height:1.7;margin:0}pre .diff-addition{background-color:#dfd}.hljs-chunk,pre .diff-chunk{color:#aaa}pre .diff-deletion{background-color:#fdd}.f1evzss3{border-top:4px solid #f20}.fsclf6o{margin:0 auto;max-width:640px;padding:20px}.f5tm013{margin:0;padding:30px 0}.f5tm013 > li{display:inline-block;list-style:none;margin-right:20px}.f5qoj4b{border-bottom-color:transparent;color:#333}.f13o7dmr h1, h2, h3, h4, h5, h6{font-weight:500}.f13o7dmr h1{font-size:1.7em}.f13o7dmr h2{font-size:1.3em}.f13o7dmr h3{font-size:1.1em}.f13o7dmr hr{border-bottom:1px dashed #fff;border-top:1px dashed #aaa;display:block;margin:1.5em 0}.f13o7dmr blockquote{border-left:4px solid #f20;margin:1em 0;padding-left:1em}.f13o7dmr img,audio,embed,video,object{height:auto;max-width:100%}.f13o7dmr code, pre{background-color:#f3f3f3;border:1px solid #ccc;color:#111;font-family:monospace;font-size:0.9em}.f13o7dmr pre{line-height:1.3;overflow-x:auto;padding:0.6em 0.8em}.f13o7dmr code{border-color:#ccc;display:inline;padding:0 0.3em;white-space:pre-line;word-wrap:break-word}.f13o7dmr pre > code{background-color:transparent;border:none;font-size:100%;padding:0;white-space:pre;word-wrap:normal}.f13o7dmr a:hover > code{border-color:#f20}.f1ymzfbz{color:#777;font-size:0.85em;margin:1.5em 0;padding:0}.f1ymzfbz > li > a{color:#777}.f1ymzfbz > li{display:inline-block;list-style:none;padding-right:20px}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="-775867885"><!-- react-empty: 2 --><div class="f1evzss3" data-reactid="3"></div><div class="fsclf6o" data-reactid="4"><ul class="f5tm013" data-reactid="5"><li data-reactid="6"><a class="f5qoj4b" href="/" data-reactid="7">Blog</a></li><li data-reactid="8"><a class="f5qoj4b" href="http://blakeembrey.me" data-reactid="9">About</a></li><li data-reactid="10"><a class="f5qoj4b" href="/rss.xml" data-reactid="11">RSS</a></li></ul><div class="f13o7dmr" data-reactid="12"><div data-reactid="13"><!-- react-empty: 14 --><h1 data-reactid="15">Introduction to Free Style (and CSS-in-JS)</h1><ul class="f1ymzfbz" data-reactid="16"><li data-reactid="17"><!-- react-text: 18 -->Written<!-- /react-text --><!-- react-text: 19 --> <!-- /react-text --><time datetime="2016-01-17T22:45:00.000Z" data-reactid="20">January 2016</time></li><li data-reactid="21"><a href="https://github.com/blakeembrey/free-style" data-reactid="22">View on GitHub</a></li><li data-reactid="23"><a href="http://npmjs.org/package/free-style" data-reactid="24">Install with NPM</a></li></ul><div data-reactid="25"><p>With the release of Free Style 1.0, I figure it’s about time to write about Free Style - how it works, why you’d want to use it and little introduction to CSS-in-JS. This has been a long time coming, with my first commit to Free Style over a year ago, and the first commit to Free Style in its current form 10 months ago. This is not a blog post designed to sway decisions - as always, you should use your own fair judgement.</p>
<h2>CSS-in-JS</h2>
<p>The idea of CSS-in-JS is well covered in <a href="https://speakerdeck.com/vjeux/react-css-in-js">this presentation by React engineer</a>, Christopher Chedeau, and by <a href="https://github.com/MicheleBertoli/css-in-js">many</a> <a href="http://formidable.com/blog/2015/03/01/launching-radium/">others</a>, so I’ll be brief. As React popularized the declarative DOM, it also enabled a generation of CSS-in-JS approaches that attempt to solve the many pitfalls of CSS. These pitfalls are well known and documented, and including “features” such as the global namespace, constant sharing and many approaches to component isolation (BEM, SMACSS). Writing CSS in a way that avoids the pitfalls can be regarded an art.</p>
<p>CSS-in-JS approaches exist to solve the pollution of the global namespace, constant sharing, component isolation, and bring many other unforeseen benefits. The JS part exists because these solutions utilize JavaScript as the way to provide namespacing, constant sharing and proper isolation. You may have already known, but these are things that have long been solved in programming languages, including JavaScript - with CommonJS, AMD and recently ES6 modules. It stands to reason that, if possible, JavaScript will provide a more sound foundation for writing modular CSS. Tooling for JavaScript is more mature, with the ability to do autocompletion, dead code elimination and linting common-place.</p>
<h2>How and Why Does Free Style Work?</h2>
<p>Free Style works with hashes. If there’s one word you should love at the end of this section, it’s hashing. With that said, the essence of <a href="https://github.com/blakeembrey/free-style/blob/master/src/free-style.ts">free-style</a> is less than 500 lines of code (in TypeScript), so I definitely suggest you check it out.</p>
<p>Free Style is built on top of a core <code>Cache</code> class. This class implements a way to append children using an ID (which is a hash), keeps track of how many times a child was added and removed, and can also attach simple change listeners (for when a child is added or removed). Three classes extend the <code>Cache</code> implementation to replicate the structure of CSS - <code>Rule</code>, <code>Style</code> and <code>FreeStyle</code>. The only other important class is <code>Selector</code>, which implements a <code>Cacheable</code> interface (<code>Cache</code> fulfills the same interface).</p>
<p>Using these four classes, we can replicate CSS in a way that automatically de-dupes styles. First, we create a <code>FreeStyle</code> instance (it can be imagined as a <code>.css</code> file). This class holds <code>Rule</code> and <code>Style</code> children. When you use <code>registerStyle</code>, it’ll stringifying each object to CSS and hash the contents, while also propagating any rules upward (E.g. when <code>@media</code> nested inside a style). The result is a single style registering (potentially) a number of <code>Style</code> and <code>Rule</code> instances, all of which have their hashes of their own contents. Throughout each instance creation, <code>registerStyle</code> collects a separate hash that is returned as the CSS class name to use. Finally, when the final class name hash is known, the class name is interpolated with all selectors and returned for you to use.</p>
<p>The result of this means that duplicate hashes are automatically merged. A duplicate hash means a duplicate rule, style or selector. The benefit of separating <code>Rule</code> and <code>Style</code> means that two identical media queries can be merged together (less CSS output) and so can identical styles within each context (E.g. identical styles inside and outside the media query can not be merged, but duplicates both inside or outside can be). The <code>Selector</code> class exists because now that duplicates are merged, multiple selectors can exist for the same <code>Style</code>.</p>
<p>The other interesting methods are <code>registerRule</code> and <code>registerKeyframes</code>. Both work similar to <code>registerStyle</code>, but are much be simpler. <code>registerRule</code> works by recursively registering rules, which are automatically being hashed based on the rule and their contents. <code>registerKeyframes</code> works by creating rules and styles that get added to a <code>Rule</code> instance and returns a selector of the complete hashed contents (hence keyframes are automatically hashed/namespaced).</p>
<p>All this hashing results in the fact that all styles are automatically unique. Registered styles and keyframes have a hash to identify them and the chance of a conflicting style is now left to the computer to resolve, not you. The other pitfalls of CSS are automatically solved as the result of JavaScript, as the hash can only be known and exposed by the implementor while constants and isolation are now solved (you can even use NPM libraries for style manipulation now).</p>
<p><strong>Update:</strong> One useful fact that may not be immediately obvious. By using hashes as the class name, it means output is <em>always</em> consistent across front-end and back-end (E.g. in isomorphic applications).</p>
<h2>Free Style Output Targets</h2>
<p>Now that you understand how Free Style works, the output targets should make a lot more sense. By default, Free Style exposes a feature-rich implementation ready for third-parties to build on top. To use it today, you must create instances of <code>FreeStyle</code> (using <code>create()</code>), merge any other instances and use <code>getStyles</code> to get the CSS output. There’s an <code>inject()</code> method, which will take the result of <code>getStyles</code> and wrap it in <code>&lt;style /&gt;</code> in the <code>&lt;head /&gt;</code>.</p>
<p>Currently, there are two other implementations of output targets. The first is <a href="https://github.com/jkroso/easy-style"><code>easy-style</code></a>, a simple wrapper around the complex functionality in Free Style that abstracts away multiple <code>FreeStyle</code> instances. It exposes three core methods - <code>style</code>, <code>rule</code>, <code>keyframe</code> - avoiding the concept of multiple instances, which makes it suitable for most web-apps. There’s also <a href="https://github.com/blakeembrey/react-free-style"><code>react-free-style</code></a>, which extends the core <code>FreeStyle</code> class with the ability to wrap React components and use React’s <code>context</code> for collecting all the styles used in the application. This is an interesting feature with interesting repercussions, such as only styles for the components on screen will be output in CSS (useful for minimizing the transfer size of isomorphic applications).</p>
<h2>Other CSS-in-JS Solutions</h2>
<p>A number of other CSS-in-JS solutions also exist, including <a href="https://github.com/FormidableLabs/radium"><code>radium</code></a>, <a href="https://github.com/js-next/react-style"><code>react-style</code></a> and <a href="https://github.com/jsstyles/jss"><code>jss</code></a>. Radium takes an all JavaScript approach, while <code>jss</code> and <code>react-style</code> are more familiar. Where <code>jss</code> and <code>react-style</code> differ to <code>free-style</code> is the approaches they take. Both went for namespacing in CSS by generating unique names instead of hashes. They also both went with <code>StyleSheet</code> instances that you create once, while <code>free-style</code> makes you register each style individually (and for a good reason, it allows linters to detect when a style is no longer used as it’ll appear as dead code). They may also restrict some subset of CSS that you can actually use for different reasons. As far as I can tell, neither go too much further into CSS tooling concepts such as style de-duping and minifying, which <code>free-style</code> gives you for free with hashes.</p>
</div><hr data-reactid="26"/><p data-reactid="27"><strong data-reactid="28">Questions?</strong><!-- react-text: 29 --> <!-- /react-text --><!-- react-text: 30 -->Ask me on<!-- /react-text --><!-- react-text: 31 --> <!-- /react-text --><a href="https://twitter.com/blakeembrey" data-reactid="32">Twitter</a><!-- react-text: 33 --> <!-- /react-text --><!-- react-text: 34 -->or in<!-- /react-text --><!-- react-text: 35 --> <!-- /react-text --><a href="https://github.com/blakeembrey/knowledge" data-reactid="36">my repo</a><!-- react-text: 37 -->.<!-- /react-text --></p></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', "UA-22855713-2", 'auto');
          ga('send', 'pageview');</script><script src="/bundle.js?t=1492907098323"></script></body></html>